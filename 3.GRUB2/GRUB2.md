# GRUB2

## 什么是GRUB2

GRUB 2 是 Ubuntu 的默认引导加载程序和管理器。 当在计算机中安装了双系统时，启动时经常会看到如下的界面

而按下键盘上的C键则会进入如下的命令行界面。

![IMG_6540](../../Documents/Tencent%20Files/614567188/FileRecv/MobileFile/IMG_6540.JPG)

当计算机启动时，GRUB 2 要么显示一个菜单并等待用户输入，要么自动将控制权转移到操作系统内核。 GRUB 2 是 GRUB（GRand Unified Bootloader）的后代。 它已被完全重写，为用户提供显着提高的灵活性和性能。

## 配置GRUB2

通常情况下对GRUB2的配置的更改应在写在``/etc/default/grub``文件中。此外，如果不以管理员的身份运行``update-grub``命令的话，grub的配置不会发生任何更改。这条命令运行了GRUB2的配置脚本，并更新``/boot/grub/grub.cfg`` 文件。

如果除了优麒麟外没有其他的操作系统被检测到，GRUB2会直接进入默认的操作系统并且不显示任何的选择菜单；反之如果监测到了其他的系统，GRUB2会显示如上图所示的默认选择菜单。需要注意的是GRUB2的显示菜单并不会一直显示。一般来说会显示指定的时间，如8秒左右。默认选择项在菜单中被高亮出来。如果直到时间耗尽还是没有任何用户输入的话（按下方向键，按下Enter键等），那么GRUB2会进入默认的系统。而一旦有按键被按下，时间限制则会取消，GRUB2会挂载不动，直到Enter键被按下（意味着用户选择进入了某个系统）。

默认启动项位于``/etc/default/grub``文件中的``GRUB_DEFAULT``字段。

## GRUB2配置文件修复

当我们在某些情况下误操作了``/boot/grub/grub.conf``，或者一些关键配置出了问题，或者MBR（关于什么是MBR可以参见上一篇文章）的引导程序遭到了破坏，主机启动之后可能只会有一个命令提示符的界面，类似

```bash
grub >
```

假如此时**优麒麟系统的启动文件没有损坏的话**，那么我们还能通过GRUB2命令行来启动操作系统。

在命令行模式下，我们能执行的命令十分有限，主要有

| 命令   | 描述                                                |
| ------ | --------------------------------------------------- |
| set    | 查看环境变量，这里可以查看启动路径和分区            |
| ls     | 查看设备                                            |
| insmod | 加载模块                                            |
| root   | 指定用于启动系统的分区,在救援模式下设置grub启动分区 |
| prefix | 设定grub启动路径                                    |

通过使用``ls``命令，可以列出磁盘中的所有分区

```
grub > (proc) (hd0) (hd0,gpt3) (hdo, gpt2) (hdo, gpt1) (hd1) (hd1,gpt4) (hd1, gpt3) (hd1, gpt2) (hd1, gpt1)
```

这里列出的是我的磁盘中的分区，不同的磁盘列出的结果可能不尽相同

通过``ls 设备名``可以区分是否优麒麟系统是否在对应设备上。如果在对应分区上则会提示``FileSystem type is ..., partition type ...``，否则则会提示``Unknown System type``或者``Unvalid File Name``。

找到了对应的设备之后可以通过``root``命令，指定用于启动系统的分区，例如在上面的例子中假设``/boot``所在的分区为``(hdo, gpt1)``,那么在grub命令行输入

```
grub > root(hdo,gpt1)
```

即可。



