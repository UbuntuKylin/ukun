# 优麒麟双系统安装教程

## 基本概念

### MBR与GPT

MBR是Master Boot Record的缩写，中文为主引导扇区或主引导记录，是计算机开机访问硬盘时所必须要读取的首个扇区，在硬盘中的位置自然也是最前面。MBR记录了硬盘本身的相关信息，硬盘各个分区的大小及位置信息和结束标志字（用来检验主引导记录是否有效）。可见如果硬盘上的MBR被损坏，那么就无法读取硬盘的相关信息。此外MBR最高只支持2TB的硬盘

GPT是GUID Partition Table的缩写，中文为全局唯一标识分区表。同样的也保存了硬盘上分区有关的信息，同时没有了MBR最高只支持识别2TB的限制，最大支持18EB的大容量（EB=1024 PB，PB=1024 TB）。

### BIOS与UEFI

BIOS是"Basic Input Output System"的缩略词，直译过来后中文名称就是"基本输入输出系统"。UEFI全称Unified Extensible Firmware Interface，即“统一的可扩展固件接口”，是一种详细描述全新类型接口的标准，是适用于电脑的标准固件接口，旨在代替BIOS。UEFI相比于BIOS做了诸多改进，但这并不是我们今天要关注的主要内容，上面提到的GBR，MBR就分别对应UEFI和BIOS读取的分区表类型。

而现在大多数的新电脑都支持UEFI启动,UEFI采用了向后兼容，所以BIOS切换为UEFI不可以，而UEFI切换为BIOS是可以的。同样的,优麒麟也支持从UEFI启动


## 工具准备

8G U盘一个。一块20G以上的空闲硬盘分区。优麒麟镜像，etcher软件。

## 启动盘制作

首先访问[官网](https://www.ubuntukylin.com/downloads/osdownload-cn.html)，下载20.04LTS Pro的系统镜像。将事先准备好的U盘中数据备份，制作启动盘时需要将U盘格式化。下面介绍两种制作启动盘的方式。
### Windows环境下

#### 软碟通
下载软件[软碟通](https://cn.ultraiso.net/)，用于制作启动盘。

![image-20210730155929538](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730155929538.png)

安装完成后打开软碟通，点击**继续试用**。

![image-20210730155939953](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730155939953.png)

左上角文件选择打开下载好的优麒麟镜像。

![image-20210730160246998](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160246998.png)
选择写入硬盘映像。

![image-20210730160306280](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160306280.png)
选择要写入的U盘，其他设置根据自己需要设置即可，一般情况下默认设置足以满足我们的需要。设置完成后点击写入等待完成即可。

![image-20210730160501211](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160501211.png)

#### etcher
下载软件[etcher](https://www.balena.io/etcher/)，用于制作启动盘。

下载完成后打开，选择刚才下载好的镜像与要作为启动盘的U盘，即可开始制作启动盘。

![image-20210730160511289](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160511289.png)

### Linux环境下
#### etcher
ether同样有Linux发行包,只需要从官网下载对应版本,重复Windows下操作即可
#### dd
``sudo fdisk -l``列出系统中设备的名称,找出启动盘在**Device**字段下的名称,形如**/dev/sda1**

执行``sudo dd if=优麒麟镜像路径 of=U盘设备名 bs=4M``命令来制作启动盘.其中if指定输入文件,在这里就是我们的优麒麟镜像, of指定输出文件,这里就是待制作的启动盘.

使用``dd``命令制作完启动盘后,会发现在Windows环境下可能无法识别,此时可以在安装好的linux环境中执行以下命令
```bash
sudo wipefs --all /dev/sdx //首先使用wipefs命令删除ISO9660文件系统标记
sudo fdisk /dev/sdx //然后对U盘进行重新分区
//进入到fdisk命令操作中后，分别执行d操作（删除原有分区）、n操作（根据提示重建分区）、w操作（保存分区表并退出）
sudo mkfs.exfat /dev/sdx //格式化U盘
```
其中``/dev/sdx``是U盘在Linux系统下的设备名,mkfs.exfat是格式化的文件格式.

## 准备工作

首先准备好一块剩余容量足够大的磁盘（推荐剩余空间20G以上），在开始菜单点击右键，选择**磁盘管理**。

<img src="%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160534134.png" alt="image-20210730160534134" style="zoom:50%;" />



打开后如下图所示
![image-20210730160610973](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160610973.png)

选择要安装系统的磁盘，这里是C盘，右键点击，在弹出菜单中选择**压缩卷**。待系统查询完可压缩空间后会弹窗提示输入压缩空间量。

![image-20210730160617242](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160617242.png)

点击压缩后会生成一块未分配的空间

![image-20210730160623865](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160623865.png)

这未分配的磁盘空间就用来安装我们的优麒麟系统。

## 进入BIOS

在Windows系统启动前进入电脑的BIOS系统。根据电脑的主板、品牌及型号的不同，进入BIOS的按键也不尽相同，常用的快捷键为< Esc,F8,F9,F10,F11,F12>。 示例中的笔记本是华硕玩家国度，按下F2进入BIOS，其余机型可以在互联网上查阅到。

![image-20210730160629212](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160629212.png)

成功从启动盘启动后进入系统安装选项界面，这里可以选择在不安装优麒麟的情况下使用，但是我们的目的是安装双系统，所以选择第三个**Install Ubuntu Kylin**。

选择安装优麒麟之后首先选择语言：

![image-20210730160633796](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160633796.png)

选择地区：

![image-20210730160639237](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160639237.png)

创建用户及密码：

![image-20210730160754870](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160754870.png)

选择安装方式，20版本的优麒麟提供了快速安装和自定义安装两种安装方式。如果我们的电脑上有空闲的硬盘则可以直接在快速安装中选中空闲的硬盘进行安装。但是大多数情况下我们希望自己的优麒麟系统能和Windows系统共存在C盘上。那么就需要选择自定义安装。

![image-20210730160800854](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160800854.png)

电脑本机上的分区表：

![image-20210730160805235](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160805235.png)

在自定义安装中可以看到本台电脑上硬盘的分区表。可以看到第一块硬盘被分成了三个区，分别简记为``p1``,``p2``,``p3``。其中``p3``是我们在进入优麒麟安装系统之前预先准备好的空闲的分区。需要指出的是我们不能直接在这里点击下一步，会提示需要挂载到根分区。观察分区表的中间部分，有一个**mounted**的字段。这个字段下面的值就是反映了当前的设备被挂载到什么分区下。

我们删除``p3``对应的分区表，新建一个``/``分区和``/home``分区，大小是准备的空闲分区的一半。下图中显示新建一个分区需要指定的参数，如

* 新分区相对剩余空间的位置
* 用于什么设备
* 分区空间大小
* 分区挂载点

而所谓的**根分区**,就是下图中的``/``挂载点。

![image-20210730160809678](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160809678.png)

挂载完成后如图所示，将原来的``p3``分成了两个等大小的新设备``p3``,``p4``，分别挂载到了``/``和``/home``下。完成了分区表的创建，我们就可以点击下一步继续安装。

![image-20210730160815998](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160815998.png)

点击下一步后，点击开始安装就会触发优麒麟的安装过程。

![image-20210730160822483](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160822483.png)

成功安装系统后重启进入BIOS，设置优麒麟为第一启动项。

![image-20210730160829209](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160829209.png)

整个操作系统的安装过程就完成了。

## 常见问题

### 安装完成后重启直接进入Windows
在BIOS设置中对启动顺序进行了规定，在安装优麒麟之前电脑默认的第一启动项是Windows的启动路径，在安装完成后需要修改第一启动路径为优麒麟，具体设置方式根据各种电脑型号进行设置。如上图中电脑的第一启动项就是优麒麟，第二启动项为Windows。

### 安装完成后重启直接进入优麒麟

在安装完成重启之后，如果依然出现下图中的情况

![Ws2GP1.md.jpg](https://z3.ax1x.com/2021/07/23/Ws2GP1.md.jpg)

则仍然是BIOS启动设置没有设置好的缘故。在之前的安装中设置了U盘为第一启动项，而重启之前没有把BIOS的第一启动项设为。把U盘拔出，或者设置磁盘中的优麒麟为第一启动项即可解决。

## 删除Ubuntu

如果遇到无法解决的问题，或者因为其他原因需要删除优麒麟，可以通过以下方式：

### 删除已安装的优麒麟分区

![W6fUqf.md.png](https://z3.ax1x.com/2021/07/24/W6fUqf.md.png)

图中**磁盘1**的120.00GB的主分区和118.21GB的主分区就是安装了优麒麟系统的分区。这里选择删除卷。

![image-20210730160844137](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160844137.png)

点击**删除卷**，会弹出以上提示。选择**是**。

![image-20210730160853034](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160853034.png)

删除后如图所示。重启电脑，进入BIOS，设置Windows为第一启动项。

进入[DiskGenius](https://www.diskgenius.cn/)的官网，下载软件，准备修复主引导记录。正如之前所提到的。每个磁盘的最开始的地方都用来存放了这个磁盘的分区相关信息。当我们把优麒麟删除之后对应的分区表也就遭到了破坏（对不上号），所以需要重建分区表。这里的话可以将删除优麒麟产生的新的空间扩展给原来的C盘空间，同时也有助于我们后面重建分区表。

![image-20210730160859524](%E4%BC%98%E9%BA%92%E9%BA%9F%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B.assets/image-20210730160859524.png)

分区搜索完成后点击左上角保存分区保存分区表时会让我们选择保存的分区表类型，MBR或者GUID，选择GUID即可，分区表重建到此完成。重启电脑即可。
